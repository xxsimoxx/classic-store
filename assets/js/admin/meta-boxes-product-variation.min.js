jQuery(function (a) { "use strict"; var i = { init: function () { a("#variable_product_options").on("change", "input.variable_is_downloadable", this.variable_is_downloadable).on("change", "input.variable_is_virtual", this.variable_is_virtual).on("change", "input.variable_manage_stock", this.variable_manage_stock).on("click", "button.notice-dismiss", this.notice_dismiss).on("click", "h3 .sort", this.set_menu_order).on("click", "button.add_price_for_variations", this.open_modal_to_set_variations_price).on("reload", this.reload).on("click", "button.create-variations", this.create_variations), a("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock").trigger("change"), a("#woocommerce-product-data").on("woocommerce_variations_loaded", this.variations_loaded), a(document.body).on("keyup", ".wc_input_variations_price", this.maybe_enable_button_to_add_price_to_variations) }, create_variations: function (i) { if (a(this).hasClass("disabled")) { i.preventDefault(); return } var e = a(".woocommerce_variation_new_attribute_data"); a("#variable_product_options").block({ message: null, overlayCSS: { background: "#fff", opacity: .6 } }); var t = e.find("input, select, textarea"), o = { post_id: woocommerce_admin_meta_boxes.post_id, product_type: a("#product-type").val(), data: t.serialize(), action: "woocommerce_add_attributes_and_variations", security: woocommerce_admin_meta_boxes.add_attributes_and_variations }; a.post(woocommerce_admin_meta_boxes.ajax_url, o, function (i) { if (i.error) window.alert(i.error), a("#variable_product_options").unblock(); else if (i) { var e = window.location.toString(); e = e.replace("post-new.php?", "post.php?post=" + woocommerce_admin_meta_boxes.post_id + "&action=edit&"), a.get(e, function (i) { a("#variable_product_options").unblock(), a("#variable_product_options_inner").replaceWith(a(i).find("#variable_product_options_inner")), a("#variable_product_options").trigger("reload"), a("#product_attributes > .product_attributes").replaceWith(a(i).find("#product_attributes > .product_attributes")) }) } }) }, reload: function () { t.load_variations(1).then(t.show_hide_variation_empty_state), o.set_paginav(0) }, variable_is_downloadable: function () { a(this).closest(".woocommerce_variation").find(".show_if_variation_downloadable").hide(), a(this).is(":checked") && a(this).closest(".woocommerce_variation").find(".show_if_variation_downloadable").show() }, variable_is_virtual: function () { a(this).closest(".woocommerce_variation").find(".hide_if_variation_virtual").show(), a(this).is(":checked") && a(this).closest(".woocommerce_variation").find(".hide_if_variation_virtual").hide() }, maybe_enable_button_to_add_price_to_variations: function () { var i = parseInt(a(".wc_input_variations_price").val(), 10); isNaN(i) ? a(".add_variations_price_button").prop("disabled", !0) : a(".add_variations_price_button").prop("disabled", !1) }, variable_manage_stock: function () { a(this).closest(".woocommerce_variation").find(".show_if_variation_manage_stock").hide(), a(this).closest(".woocommerce_variation").find(".variable_stock_status").show(), a(this).is(":checked") && (a(this).closest(".woocommerce_variation").find(".show_if_variation_manage_stock").show(), a(this).closest(".woocommerce_variation").find(".variable_stock_status").hide()), a("input#_manage_stock:checked").length && a(this).closest(".woocommerce_variation").find(".variable_stock_status").hide() }, notice_dismiss: function () { a(this).closest("div.notice").remove() }, variations_loaded: function (e, t) { t = t || !1; var o = a("#woocommerce-product-data"); t || (a("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock", o).trigger("change"), a(".woocommerce_variation", o).each(function (i, e) { var t = a(e), o = a(".sale_price_dates_from", t).val(), n = a(".sale_price_dates_to", t).val(); ("" !== o || "" !== n) && a("a.sale_schedule", t).trigger("click") }), a(".woocommerce_variations .variation-needs-update", o).removeClass("variation-needs-update"), a("button.cancel-variation-changes, button.save-variation-changes", o).attr("disabled", "disabled")), a("#tiptip_holder").removeAttr("style"), a("#tiptip_arrow").removeAttr("style"), a(".woocommerce_variations .tips, .woocommerce_variations .help_tip, .woocommerce_variations .woocommerce-help-tip, .toolbar-variations-defaults .woocommerce-help-tip", o).tipTip({ attribute: "data-tip", fadeIn: 50, fadeOut: 50, delay: 200 }), a(".sale_price_dates_fields", o).find("input").datepicker({ defaultDate: "", dateFormat: "yy-mm-dd", numberOfMonths: 1, showButtonPanel: !0, onSelect: function () { var i = a(this).is(".sale_price_dates_from") ? "minDate" : "maxDate", e = a(this).closest(".sale_price_dates_fields").find("input"), t = a(this).datepicker("getDate"); e.not(this).datepicker("option", i, t), a(this).trigger("change") } }), a(".woocommerce_variations", o).sortable({ items: ".woocommerce_variation", cursor: "move", axis: "y", handle: ".sort", scrollSensitivity: 40, forcePlaceholderSize: !0, helper: "clone", opacity: .65, stop: function () { i.variation_row_indexes() } }), a(document.body).trigger("wc-enhanced-select-init") }, set_variations_price: function () { var i = a(".wc_input_variations_price").val(), e = a("select#product-type").val(); a(`.wc_input_price[name^=${"variable-subscription" === e ? "variable_subscription_sign_up_fee" : "variable_regular_price"}]`).each(function (e, t) { ("0" === a(t).val() || "" === a(t).val()) && a(t).val(i).trigger("change") }), t.save_variations() }, open_modal_to_set_variations_price: function () { a(this).WCBackboneModal({ template: "wc-modal-set-price-variations" }), a(".add_variations_price_button").on("click", i.set_variations_price) }, set_menu_order: function (i) { i.preventDefault(); var e = a(this).closest(".woocommerce_variation").find(".variation_menu_order"), o = a(this).closest(".woocommerce_variation").find(".variable_post_id").val(), n = window.prompt(woocommerce_admin_meta_boxes_variations.i18n_enter_menu_order, e.val()); null != n && (e.val(parseInt(n, 10)).trigger("change"), a(this).closest(".woocommerce_variation").append('<input type="hidden" name="new_variation_menu_order_id" value="' + encodeURIComponent(o) + '" />'), a(this).closest(".woocommerce_variation").append('<input type="hidden" name="new_variation_menu_order_value" value="' + encodeURIComponent(parseInt(n, 10)) + '" />'), t.save_variations()) }, variation_row_indexes: function () { var i = a("#variable_product_options").find(".woocommerce_variations"), e = parseInt(i.attr("data-page"), 10), t = parseInt((e - 1) * woocommerce_admin_meta_boxes_variations.variations_per_page, 10); a(".woocommerce_variations .woocommerce_variation").each(function (i, e) { a(".variation_menu_order", e).val(parseInt(a(e).index(".woocommerce_variations .woocommerce_variation"), 10) + 1 + t).trigger("change") }) } }, e = { variable_image_frame: null, setting_variation_image_id: null, setting_variation_image: null, wp_media_post_id: wp.media.model.settings.post.id, init: function () { a("#variable_product_options").on("click", ".upload_image_button", this.add_image), a("a.add_media").on("click", this.restore_wp_media_post_id) }, add_image: function (i) { var t = a(this), o = t.attr("rel"), n = t.closest(".upload_image"); if (e.setting_variation_image = n, e.setting_variation_image_id = o, i.preventDefault(), t.is(".remove")) a(".upload_image_id", e.setting_variation_image).val("").trigger("change"), e.setting_variation_image.find("img").eq(0).attr("src", woocommerce_admin_meta_boxes_variations.woocommerce_placeholder_img_src), e.setting_variation_image.find(".upload_image_button").removeClass("remove"); else { if (e.variable_image_frame) { e.variable_image_frame.uploader.uploader.param("post_id", e.setting_variation_image_id), e.variable_image_frame.open(); return } wp.media.model.settings.post.id = e.setting_variation_image_id, e.variable_image_frame = wp.media.frames.variable_image = wp.media({ title: woocommerce_admin_meta_boxes_variations.i18n_choose_image, button: { text: woocommerce_admin_meta_boxes_variations.i18n_set_image }, states: [new wp.media.controller.Library({ title: woocommerce_admin_meta_boxes_variations.i18n_choose_image, filterable: "all" }),] }), e.variable_image_frame.on("select", function () { var i = e.variable_image_frame.state().get("selection").first().toJSON(), t = i.sizes && i.sizes.thumbnail ? i.sizes.thumbnail.url : i.url; a(".upload_image_id", e.setting_variation_image).val(i.id).trigger("change"), e.setting_variation_image.find(".upload_image_button").addClass("remove"), e.setting_variation_image.find("img").eq(0).attr("src", t), wp.media.model.settings.post.id = e.wp_media_post_id }), e.variable_image_frame.open() } }, restore_wp_media_post_id: function () { wp.media.model.settings.post.id = e.wp_media_post_id } }, t = { init: function () { a("li.variations_tab a").on("click", this.initial_load), a("#variable_product_options").on("click", "button.save-variation-changes", this.save_variations).on("click", "button.cancel-variation-changes", this.cancel_variations).on("click", ".remove_variation", this.remove_variation).on("click", ".downloadable_files a.delete", this.input_changed), a(document.body).on("change input", "#variable_product_options .woocommerce_variations :input", this.input_changed).on("change", ".variations-defaults select", this.defaults_changed); var i = a("form#post"); i.on("submit", this.save_on_submit), a("input:submit", i).on("click keypress", function () { i.data("callerid", this.id) }), a(".wc-metaboxes-wrapper").on("change", "#field_to_edit", this.do_variation_action), a(".wc-metaboxes-wrapper").on("click", "button.generate_variations", this.generate_variations), a(".wc-metaboxes-wrapper").on("click", "button.add_variation_manually", this.add_variation_manually) }, check_for_changes: function () { var i = a("#variable_product_options").find(".woocommerce_variations .variation-needs-update"); if (0 < i.length) { if (!window.confirm(woocommerce_admin_meta_boxes_variations.i18n_edited_variations)) return i.removeClass("variation-needs-update"), !1; t.save_changes() } return !0 }, block: function () { a("#woocommerce-product-data").block({ message: null, overlayCSS: { background: "#fff", opacity: .6 } }) }, unblock: function () { a("#woocommerce-product-data").unblock() }, initial_load: function () { 0 === a("#variable_product_options").find(".woocommerce_variations .woocommerce_variation").length && o.go_to_page() }, load_variations: function (i, e) { return new Promise((o, n) => { i = i || 1, e = e || woocommerce_admin_meta_boxes_variations.variations_per_page; var r = a("#variable_product_options").find(".woocommerce_variations"); t.block(), a.ajax({ url: woocommerce_admin_meta_boxes_variations.ajax_url, data: { action: "woocommerce_load_variations", security: woocommerce_admin_meta_boxes_variations.load_variations_nonce, product_id: woocommerce_admin_meta_boxes_variations.post_id, attributes: r.data("attributes"), page: i, per_page: e }, type: "POST", success: function (e) { r.empty().append(e).attr("data-page", i), a("#woocommerce-product-data").trigger("woocommerce_variations_loaded"), t.unblock(), o(e) }, error: function (a, i, e) { t.unblock(), n({ jqXHR: a, textStatus: i, errorThrown: e }) } }) }) }, get_variations_fields: function (i) { var e = a(":input", i).serializeJSON(); return a(".variations-defaults select").each(function (i, t) { var o = a(t); e[o.attr("name")] = o.val() }), e }, save_changes: function (i) { var e = a("#variable_product_options").find(".woocommerce_variations"), o = a(".variation-needs-update", e), n = {}; 0 < o.length && (t.block(), (n = t.get_variations_fields(o)).action = "woocommerce_save_variations", n.security = woocommerce_admin_meta_boxes_variations.save_variations_nonce, n.product_id = woocommerce_admin_meta_boxes_variations.post_id, n["product-type"] = a("#product-type").val(), a.ajax({ url: woocommerce_admin_meta_boxes_variations.ajax_url, data: n, type: "POST", success: function (e) { o.removeClass("variation-needs-update"), a("button.cancel-variation-changes, button.save-variation-changes").attr("disabled", "disabled"), a("#woocommerce-product-data").trigger("woocommerce_variations_saved"), "function" == typeof i && i(e), t.unblock() } })) }, save_variations: function () { return a("#variable_product_options").trigger("woocommerce_variations_save_variations_button"), t.save_changes(function (i) { var e = a("#variable_product_options").find(".woocommerce_variations"), t = e.attr("data-page"); a("#variable_product_options").find("#woocommerce_errors").remove(), i && e.before(i), a(".variations-defaults select").each(function () { a(this).attr("data-current", a(this).val()) }), o.go_to_page(t) }), !1 }, save_on_submit: function (i) { 0 < a("#variable_product_options").find(".woocommerce_variations .variation-needs-update").length && (i.preventDefault(), a("#variable_product_options").trigger("woocommerce_variations_save_variations_on_submit"), t.save_changes(t.save_on_submit_done)) }, save_on_submit_done: function () { var i = a("form#post"); "publish" === i.data("callerid") ? i.append('<input type="hidden" name="publish" value="1" />').trigger("submit") : i.append('<input type="hidden" name="save-post" value="1" />').trigger("submit") }, cancel_variations: function () { var i = parseInt(a("#variable_product_options").find(".woocommerce_variations").attr("data-page"), 10); return a("#variable_product_options").find(".woocommerce_variations .variation-needs-update").removeClass("variation-needs-update"), a(".variations-defaults select").each(function () { a(this).val(a(this).attr("data-current")) }), o.go_to_page(i), !1 }, add_variation: function () { t.block(); var e = { action: "woocommerce_add_variation", post_id: woocommerce_admin_meta_boxes_variations.post_id, loop: a(".woocommerce_variation").length, security: woocommerce_admin_meta_boxes_variations.add_variation_nonce }; return a.post(woocommerce_admin_meta_boxes_variations.ajax_url, e, function (e) { var n = a(e); n.addClass("variation-needs-update"), a(".woocommerce-notice-invalid-variation").remove(), a("#variable_product_options").find(".woocommerce_variations").prepend(n), a("button.cancel-variation-changes, button.save-variation-changes").prop("disabled", !1), o.update_single_quantity(), i.variations_loaded(null, !0), t.show_hide_variation_empty_state(), a("#variable_product_options").trigger("woocommerce_variations_added", 1), t.unblock() }), !1 }, remove_variation: function () { if (t.check_for_changes(), window.confirm(woocommerce_admin_meta_boxes_variations.i18n_remove_variation)) { var i = a(this).attr("rel"), e = [], n = { action: "woocommerce_remove_variations" }; t.block(), 0 < i ? (e.push(i), n.variation_ids = e, n.security = woocommerce_admin_meta_boxes_variations.delete_variations_nonce, a.post(woocommerce_admin_meta_boxes_variations.ajax_url, n, function () { var i = a("#variable_product_options").find(".woocommerce_variations"), e = parseInt(i.attr("data-page"), 10), t = Math.ceil((parseInt(i.attr("data-total"), 10) - 1) / woocommerce_admin_meta_boxes_variations.variations_per_page), n = 1; a("#woocommerce-product-data").trigger("woocommerce_variations_removed"), e === t || e <= t ? n = e : e > t && 0 !== t && (n = t), 0 === t && a(".generate_variations").text("Generate variations"), o.go_to_page(n, -1) })) : t.unblock() } return !1 }, link_all_variations: function () { if (t.check_for_changes(), window.confirm(woocommerce_admin_meta_boxes_variations.i18n_link_all_variations)) { t.block(); var i = { action: "woocommerce_link_all_variations", post_id: woocommerce_admin_meta_boxes_variations.post_id, security: woocommerce_admin_meta_boxes_variations.link_variation_nonce }; a.post(woocommerce_admin_meta_boxes_variations.ajax_url, i, function (i) { let e = parseInt(i, 10) || 0; t.show_hide_variation_empty_state(), e > 0 ? (o.go_to_page(1, e), a(".generate_variations").text("Regenerate variations")) : t.unblock() }) } return !1 }, input_changed: function (i) { a(this).closest(".woocommerce_variation").addClass("variation-needs-update"), a("button.cancel-variation-changes, button.save-variation-changes").prop("disabled", !1), !("input" === i.type && a(this).is(":text")) && a("#variable_product_options").trigger("woocommerce_variations_input_changed") }, defaults_changed: function () { a(this).closest("#variable_product_options").find(".woocommerce_variation:first").addClass("variation-needs-update"), a("button.cancel-variation-changes, button.save-variation-changes").prop("disabled", !1), a("#variable_product_options").trigger("woocommerce_variations_defaults_changed") }, do_variation_action: function () { var i, e = a(this).val(), n = {}, r = 0; switch (e) { case "delete_all": window.confirm(woocommerce_admin_meta_boxes_variations.i18n_delete_all_variations) && window.confirm(woocommerce_admin_meta_boxes_variations.i18n_last_warning) && (n.allowed = !0, r = -1 * parseInt(a("#variable_product_options").find(".woocommerce_variations").attr("data-total"), 10)); break; case "variable_regular_price_increase": case "variable_regular_price_decrease": case "variable_sale_price_increase": case "variable_sale_price_decrease": let s = woocommerce_admin_meta_boxes_variations.i18n_enter_a_value_fixed_or_percent; if (("variable_regular_price_decrease" === e || "variable_sale_price_increase" === e) && (s += "\n\n" + woocommerce_admin_meta_boxes_variations.i18n_sale_price_warning), null == (i = window.prompt(s))) return; i.indexOf("%") >= 0 ? n.value = accounting.unformat(i.replace(/\%/, ""), woocommerce_admin.mon_decimal_point) + "%" : n.value = accounting.unformat(i, woocommerce_admin.mon_decimal_point); break; case "variable_regular_price": case "variable_sale_price": case "variable_stock": case "variable_low_stock_amount": case "variable_weight": case "variable_length": case "variable_width": case "variable_height": case "variable_download_limit": case "variable_download_expiry": if (null == (i = window.prompt(woocommerce_admin_meta_boxes_variations.i18n_enter_a_value))) return; n.value = i; break; case "variable_sale_schedule": if (n.date_from = window.prompt(woocommerce_admin_meta_boxes_variations.i18n_scheduled_sale_start), n.date_to = window.prompt(woocommerce_admin_meta_boxes_variations.i18n_scheduled_sale_end), null === n.date_from && (n.date_from = !1), null === n.date_to && (n.date_to = !1), !1 === n.date_to && !1 === n.date_from) return; break; default: if (a("select.variation_actions").trigger(e), null === (n = a("select.variation_actions").triggerHandler(e + "_ajax_data", n))) return }"delete_all" === e && n.allowed ? (a("#variable_product_options").find(".variation-needs-update").removeClass("variation-needs-update"), a(".generate_variations").text("Generate variations")) : t.check_for_changes(), t.block(), a.ajax({ url: woocommerce_admin_meta_boxes_variations.ajax_url, data: { action: "woocommerce_bulk_edit_variations", security: woocommerce_admin_meta_boxes_variations.bulk_edit_variations_nonce, product_id: woocommerce_admin_meta_boxes_variations.post_id, product_type: a("#product-type").val(), bulk_action: e, data: n }, type: "POST", success: function () { o.go_to_page(1, r) } }) }, show_hide_variation_empty_state: function () { var i = a("#variable_product_options").find(".woocommerce_variations"); parseInt(i.attr("data-total")) > 0 ? (a("#variable_product_options_inner").removeClass("no-variations"), a("#field_to_edit").removeClass("hidden")) : (a("#variable_product_options_inner").addClass("no-variations"), a("#field_to_edit").addClass("hidden")) }, generate_variations: function () { t.link_all_variations() }, add_variation_manually: function () { t.add_variation() } }, o = { init: function () { a(document.body).on("change", ".variations-pagenav .page-selector", this.page_selector).on("click", ".variations-pagenav .first-page", this.first_page).on("click", ".variations-pagenav .prev-page", this.prev_page).on("click", ".variations-pagenav .next-page", this.next_page).on("click", ".variations-pagenav .last-page", this.last_page) }, update_variations_count: function (i) { var e = a("#variable_product_options").find(".woocommerce_variations"), t = parseInt(e.attr("data-total"), 10) + i, o = a(".variations-pagenav .displaying-num"); e.attr("data-total", t); let n = 1 === t ? woocommerce_admin_meta_boxes_variations.i18n_variation_count_single : woocommerce_admin_meta_boxes_variations.i18n_variation_count_plural.replace("%qty%", t); return o.text(n), t }, update_single_quantity: function () { o.update_variations_count(1); let i = a(".variations-pagenav"); i.is(":hidden") && (a("option, optgroup", ".variation_actions").show(), a(".variation_actions").val("bulk_actions"), a("#variable_product_options").find(".toolbar").show(), i.show(), a(".pagination-links", i).hide()) }, set_paginav: function (i) { var e = a("#variable_product_options").find(".woocommerce_variations"), t = o.update_variations_count(i), n = a("#variable_product_options").find(".toolbar"), r = a(".variation_actions"), s = a(".variations-pagenav"), c = a(".pagination-links", s), l = Math.ceil(t / woocommerce_admin_meta_boxes_variations.variations_per_page), d = ""; e.attr("data-total_pages", l), a(".total-pages", s).text(l); for (var v = 1; v <= l; v++)d += '<option value="' + v + '">' + v + "</option>"; a(".page-selector", s).empty().html(d), 0 === t ? (n.not(".toolbar-top, .toolbar-buttons").hide(), s.hide(), a("option, optgroup", r).hide(), a(".variation_actions").val("bulk_actions"), a('option[data-global="true"]', r).show()) : (n.show(), s.show(), a("option, optgroup", r).show(), a(".variation_actions").val("bulk_actions"), 1 === l ? c.hide() : c.show()) }, check_is_enabled: function (i) { return !a(i).hasClass("disabled") }, change_classes: function (i, e) { var t = a(".variations-pagenav .first-page"), o = a(".variations-pagenav .prev-page"), n = a(".variations-pagenav .next-page"), r = a(".variations-pagenav .last-page"); 1 === i ? (t.addClass("disabled"), o.addClass("disabled")) : (t.removeClass("disabled"), o.removeClass("disabled")), e === i ? (n.addClass("disabled"), r.addClass("disabled")) : (n.removeClass("disabled"), r.removeClass("disabled")) }, set_page: function (i) { a(".variations-pagenav .page-selector").val(i).first().trigger("change") }, go_to_page: function (a, i) { a = a || 1, i = i || 0, o.set_paginav(i), o.set_page(a) }, page_selector: function () { var i = parseInt(a(this).val(), 10), e = a("#variable_product_options").find(".woocommerce_variations"); a(".variations-pagenav .page-selector").val(i), t.check_for_changes(), o.change_classes(i, parseInt(e.attr("data-total_pages"), 10)), t.load_variations(i).then(t.show_hide_variation_empty_state()) }, first_page: function () { return o.check_is_enabled(this) && o.set_page(1), !1 }, prev_page: function () { if (o.check_is_enabled(this)) { var i = a("#variable_product_options").find(".woocommerce_variations"), e = parseInt(i.attr("data-page"), 10) - 1; o.set_page(0 < e ? e : 1) } return !1 }, next_page: function () { if (o.check_is_enabled(this)) { var i = a("#variable_product_options").find(".woocommerce_variations"), e = parseInt(i.attr("data-total_pages"), 10), t = parseInt(i.attr("data-page"), 10) + 1; o.set_page(e >= t ? t : e) } return !1 }, last_page: function () { if (o.check_is_enabled(this)) { var i = a("#variable_product_options").find(".woocommerce_variations").attr("data-total_pages"); o.set_page(i) } return !1 } }; i.init(), e.init(), t.init(), o.init() });